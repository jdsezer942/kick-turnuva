<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Ramazan Ã–zel Quiz</title>
  <style>body{background:#111;color:#fff;text-align:center;padding:20px;}button{background:#00ff00;color:black;padding:20px;font-size:24px;border:none;border-radius:10px;cursor:pointer;}.option{border:3px solid #00ff00;padding:20px;margin:10px;border-radius:10px;cursor:pointer;font-size:18px;}</style>
</head>
<body>

<h1>ğŸ½ï¸ Yemek TurnuvasÄ±</h1>

<div id="login">
  <button onclick="login()">KICK Ä°LE GÄ°RÄ°Å YAP VE BAÅLA</button>
</div>

<div id="game" style="display:none;">
  <h2 id="round">Tur</h2>
  <div style="display:flex;justify-content:center;gap:30px;">
    <div id="choice1" class="option" onclick="pick(0)"></div>
    <div style="font-size:28px;">VS</div>
    <div id="choice2" class="option" onclick="pick(1)"></div>
  </div>
  <p id="match"></p>
</div>

<script>
const CLIENT_ID = "01KHSMYKTDM9DD6Y4HHBV0RYSB";
const REDIRECT_URI = location.origin + '/callback.html';

let items = ["Adana Kebap", "Ä°skender", "Lahmacun", "MantÄ±", "DÃ¶ner", "Kumpir", "Baklava", "Sarma", "Dolma", "Pide", "Pizza", "Hamburger"];
let currentRound = [], nextRound = [], matchIndex = 0;

if (localStorage.getItem('kick_token')) {
  document.getElementById('login').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  start();
}

function login() {
  const state = Math.random().toString(36).substring(2);
  localStorage.setItem('kick_state', state);

  const verifier = btoa(String.fromCharCode(...crypto.getRandomValues(new Uint8Array(32)))).replace(/[^a-zA-Z0-9]/g,'');
  localStorage.setItem('kick_verifier', verifier);

  crypto.subtle.digest('SHA-256', new TextEncoder().encode(verifier)).then(hash => {
    const challenge = btoa(String.fromCharCode(...new Uint8Array(hash))).replace(/[^a-zA-Z0-9]/g,'');

    const p = new URLSearchParams({
      client_id: CLIENT_ID,
      redirect_uri: REDIRECT_URI,
      response_type: 'code',
      scope: 'user:read channel:read',
      state: state,
      code_challenge_method: 'S256',
      code_challenge: challenge
    });

    location.href = `https://id.kick.com/oauth/authorize?${p}`;
  });
}

async function start() {
  currentRound = [...items].sort(() => Math.random() - 0.5);
  showMatch();
}

function showMatch() {
  if (currentRound.length === 1) {
    document.getElementById('game').innerHTML = `<h2>ğŸ† Åampiyon: ${currentRound[0]} ğŸ†</h2>`;
    return;
  }
  document.getElementById('round').innerText = currentRound.length + "'li Tur";
  document.getElementById('choice1').innerText = currentRound[matchIndex];
  document.getElementById('choice2').innerText = currentRound[matchIndex + 1];
  document.getElementById('match').innerText = `EÅŸleÅŸme ${Math.floor(matchIndex/2)+1} / ${currentRound.length/2}`;
}

function pick(n) {
  nextRound.push(currentRound[matchIndex + n]);
  matchIndex += 2;
  if (matchIndex >= currentRound.length) {
    currentRound = [...nextRound];
    nextRound = [];
    matchIndex = 0;
  }
  showMatch();
}
</script>
</body>
</html>
